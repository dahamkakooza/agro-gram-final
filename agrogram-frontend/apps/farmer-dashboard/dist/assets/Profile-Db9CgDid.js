import{u as I,r as d,i as x,j as e,b as M,C as m,B as g}from"./index-C07V4r8E.js";import{I as c}from"./input-kLXWFfVH.js";import{S as O}from"./Select-CJWIEbcx.js";import{T as U}from"./Tabs-xtqnmJ3V.js";import{T as q}from"./TextArea-Dt6jrW99.js";const Q=()=>{var A;const{userProfile:i,refreshProfile:C}=I(),[u,F]=d.useState("personal"),[D,v]=d.useState(!0),[N,h]=d.useState(!1),[b,y]=d.useState([]),[r,_]=d.useState(null),[P,p]=d.useState(""),[t,l]=d.useState({first_name:"",last_name:"",phone_number:"",location:"",farm_size:"",business_name:"",business_description:"",latitude:"",longitude:""}),[n,f]=d.useState({price_range_min:"",price_range_max:"",quality_preference:"STANDARD",preferred_locations:[]});d.useEffect(()=>{i?(E(),L()):v(!1)},[i]);const E=()=>{i&&(l({first_name:i.first_name||"",last_name:i.last_name||"",phone_number:i.phone_number||"",location:i.location||"",farm_size:i.farm_size||"",business_name:i.business_name||"",business_description:i.business_description||"",latitude:i.latitude||"",longitude:i.longitude||""}),i.preferences&&f({price_range_min:i.preferences.price_range_min||"",price_range_max:i.preferences.price_range_max||"",quality_preference:i.preferences.quality_preference||"STANDARD",preferred_locations:i.preferences.preferred_locations||[]}))},S=()=>({total_farms:0,total_plots:0,active_crops:0,pending_tasks:0,total_orders:0,total_revenue:0,profile_completion:0,productivity_level:"MEDIUM",success_rate:0,efficiency_score:0}),L=async()=>{var a;try{v(!0),p("");try{const s=await x.getActivities();if(s.success){const o=s.data;y(o.activities||o.results||((a=o.data)==null?void 0:a.activities)||[])}}catch(s){console.warn("Activities endpoint failed:",s),y([])}try{const s=await x.getUserStats();s.success?_(s.data):_(S())}catch(s){console.warn("Stats endpoint failed:",s),_(S())}}catch(s){console.error("Error fetching profile data:",s),p("Failed to load some profile data. Some features may be limited.")}finally{v(!1)}},R=async a=>{a.preventDefault(),h(!0),p("");try{const s={...t};Object.keys(s).forEach(j=>{(s[j]===""||s[j]===null)&&delete s[j]});const o=await x.updateProfile(s);o.success?(await C(),alert("Profile updated successfully!")):p(o.message||"Failed to update profile. Please try again.")}catch(s){console.error("Error updating profile:",s),p("Failed to update profile. Please try again.")}finally{h(!1)}},T=async a=>{a.preventDefault(),h(!0),p("");try{const s={price_range_min:n.price_range_min?parseFloat(n.price_range_min):null,price_range_max:n.price_range_max?parseFloat(n.price_range_max):null,quality_preference:n.quality_preference||"STANDARD",preferred_locations:Array.isArray(n.preferred_locations)?n.preferred_locations:[]};console.log("📦 Sending preferences:",s);const o=await x.updateUserPreferences(s);o.success?alert("Preferences updated successfully!"):p(o.message||"Failed to update preferences. Please try again.")}catch(s){console.error("Error updating preferences:",s),p("Failed to update preferences. Please try again.")}finally{h(!1)}};if(D)return e.jsxs("div",{className:"loading",children:[e.jsx(M,{size:"large"}),e.jsx("p",{children:"Loading profile..."})]});if(!i)return e.jsx("div",{className:"profile-error",children:e.jsx(m,{children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Profile Not Found"}),e.jsx("p",{children:"Unable to load your profile. Please try refreshing the page or contact support."}),e.jsx(g,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})})});const w=(r==null?void 0:r.profile_completion)||0;return e.jsxs("div",{className:"profile",children:[e.jsx("div",{className:"profile__header",children:e.jsxs("div",{className:"profile__info",children:[e.jsx("h1",{children:"Profile Settings"}),e.jsxs("div",{className:"profile-stats",children:[e.jsxs("span",{className:"completion-badge",children:["Profile ",Math.round(w),"% Complete"]}),e.jsx("span",{className:"verification-badge",children:i.is_verified?"✅ Verified":"⏳ Pending Verification"})]})]})}),P&&e.jsx("div",{className:"profile__error",children:e.jsx(m,{className:"error-card",children:e.jsx("p",{children:P})})}),e.jsx(U,{tabs:[{id:"personal",label:"Personal Info"},{id:"preferences",label:"Preferences"},{id:"activity",label:"Activity"},{id:"stats",label:"Statistics"}],activeTab:u,onChange:F}),e.jsxs("div",{className:"profile__content",children:[u==="personal"&&e.jsxs("div",{className:"personal-info",children:[e.jsx(m,{title:"Personal Information",children:e.jsxs("form",{onSubmit:R,className:"profile-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsx(c,{label:"First Name",value:t.first_name,onChange:a=>l(s=>({...s,first_name:a.target.value})),required:!0}),e.jsx(c,{label:"Last Name",value:t.last_name,onChange:a=>l(s=>({...s,last_name:a.target.value})),required:!0}),e.jsx(c,{label:"Phone Number",value:t.phone_number,onChange:a=>l(s=>({...s,phone_number:a.target.value}))}),e.jsx(c,{label:"Location",value:t.location,onChange:a=>l(s=>({...s,location:a.target.value}))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Farm Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsx(c,{label:"Farm Size (acres)",type:"number",step:"0.01",value:t.farm_size,onChange:a=>l(s=>({...s,farm_size:a.target.value}))}),e.jsx(c,{label:"Business Name",value:t.business_name,onChange:a=>l(s=>({...s,business_name:a.target.value}))})]}),e.jsx(q,{label:"Business Description",value:t.business_description,onChange:a=>l(s=>({...s,business_description:a.target.value})),rows:3})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Location Coordinates (Optional)"}),e.jsxs("div",{className:"form-grid",children:[e.jsx(c,{label:"Latitude",type:"number",step:"0.000001",value:t.latitude,onChange:a=>l(s=>({...s,latitude:a.target.value}))}),e.jsx(c,{label:"Longitude",type:"number",step:"0.000001",value:t.longitude,onChange:a=>l(s=>({...s,longitude:a.target.value}))})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx(g,{type:"submit",variant:"primary",loading:N,children:"Update Profile"})})]})}),e.jsx(m,{title:"Account Information",children:e.jsxs("div",{className:"account-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email:"}),e.jsx("span",{children:i.email||"Not set"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Role:"}),e.jsx("span",{className:"role-badge",children:i.role||"Not set"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Member Since:"}),e.jsx("span",{children:i.created_at?new Date(i.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Last Activity:"}),e.jsx("span",{children:i.last_activity?new Date(i.last_activity).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Login Count:"}),e.jsx("span",{children:i.login_count||0})]})]})})]}),u==="preferences"&&e.jsx("div",{className:"preferences",children:e.jsx(m,{title:"Marketplace Preferences",children:e.jsxs("form",{onSubmit:T,className:"preferences-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Price Range Preferences"}),e.jsxs("div",{className:"form-grid",children:[e.jsx(c,{label:"Minimum Price",type:"number",step:"0.01",value:n.price_range_min,onChange:a=>f(s=>({...s,price_range_min:a.target.value}))}),e.jsx(c,{label:"Maximum Price",type:"number",step:"0.01",value:n.price_range_max,onChange:a=>f(s=>({...s,price_range_max:a.target.value}))})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Quality Preferences"}),e.jsx(O,{label:"Preferred Quality Grade",options:[{value:"PREMIUM",label:"Premium"},{value:"STANDARD",label:"Standard"},{value:"ECONOMY",label:"Economy"}],value:n.quality_preference,onChange:a=>{typeof a=="string"?f(s=>({...s,quality_preference:a})):a&&a.target&&f(s=>({...s,quality_preference:a.target.value}))}})]}),e.jsx("div",{className:"form-actions",children:e.jsx(g,{type:"submit",variant:"primary",loading:N,children:"Save Preferences"})})]})})}),u==="activity"&&e.jsx("div",{className:"activity",children:e.jsx(m,{title:"Recent Activity",children:b.length>0?e.jsx("div",{className:"activity-list",children:b.map(a=>e.jsxs("div",{className:"activity-item",children:[e.jsxs("div",{className:"activity-icon",children:[a.activity_type==="LOGIN"&&"🔐",a.activity_type==="LOGOUT"&&"🚪",a.activity_type==="PROFILE_UPDATE"&&"👤",!["LOGIN","LOGOUT","PROFILE_UPDATE"].includes(a.activity_type)&&"📝"]}),e.jsxs("div",{className:"activity-content",children:[e.jsx("p",{children:a.description||`Activity: ${a.activity_type}`}),e.jsxs("small",{children:[a.created_at?new Date(a.created_at).toLocaleString():"Unknown date",a.ip_address&&` • IP: ${a.ip_address}`]})]})]},a.id))}):e.jsx("div",{className:"no-activity",children:e.jsx("p",{children:"No recent activity found"})})})}),u==="stats"&&r&&e.jsxs("div",{className:"statistics",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsx(m,{title:"Farm Statistics",children:e.jsxs("div",{className:"stats-list",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:r.total_farms||0}),e.jsx("span",{className:"stat-label",children:"Total Farms"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:r.total_plots||0}),e.jsx("span",{className:"stat-label",children:"Total Plots"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:r.active_crops||0}),e.jsx("span",{className:"stat-label",children:"Active Crops"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:r.pending_tasks||0}),e.jsx("span",{className:"stat-label",children:"Pending Tasks"})]})]})}),e.jsx(m,{title:"Business Statistics",children:e.jsxs("div",{className:"stats-list",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:r.total_orders||0}),e.jsx("span",{className:"stat-label",children:"Total Orders"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsxs("span",{className:"stat-value",children:["$",r.total_revenue||0]}),e.jsx("span",{className:"stat-label",children:"Total Revenue"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsxs("span",{className:"stat-value",children:[Math.round(r.profile_completion||0),"%"]}),e.jsx("span",{className:"stat-label",children:"Profile Complete"})]})]})})]}),(i.role==="FARMER"||!i.role)&&e.jsx(m,{title:"Performance Metrics",children:e.jsxs("div",{className:"performance-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Productivity Level"}),e.jsx("span",{className:`metric-value productivity-${((A=r.productivity_level)==null?void 0:A.toLowerCase())||"medium"}`,children:r.productivity_level||"Medium"})]}),e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Success Rate"}),e.jsx("span",{className:"metric-value",children:r.success_rate?`${(r.success_rate*100).toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Resource Efficiency"}),e.jsx("span",{className:"metric-value",children:r.efficiency_score?`${(r.efficiency_score*100).toFixed(1)}%`:"N/A"})]})]})})]})]})]})};export{Q as default};
//# sourceMappingURL=Profile-Db9CgDid.js.map
