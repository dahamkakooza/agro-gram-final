import{r as i,a as z,c as h,j as s,b as T,B as g,A as E,C as l}from"./index-C07V4r8E.js";import{T as U}from"./TextArea-Dt6jrW99.js";const X=()=>{var w,C,M,D,L;const[o,F]=i.useState([]),[t,k]=i.useState(null),[x,$]=i.useState([]),[d,j]=i.useState(""),[q,p]=i.useState(!0),[A,v]=i.useState(!1),[N,f]=i.useState(!1),[y,n]=i.useState(""),[_,m]=i.useState(""),B=z();i.useEffect(()=>{u()},[]);const u=async()=>{p(!0),n("");try{const e=await h.getConversations();e.success?F(e.data.conversations||e.data||[]):n(e.message||"Failed to load conversations")}catch(e){console.error("Error fetching conversations:",e),n("Failed to load conversations")}finally{p(!1)}},S=async e=>{v(!0),n("");try{const a=await h.getMessages(e);if(a.success){$(a.data.messages||a.data||[]);const c=o.find(r=>r.id===e);k(c)}else n(a.message||"Failed to load messages")}catch(a){console.error("Error fetching messages:",a),n("Failed to load messages")}finally{v(!1)}},R=async e=>{if(e.preventDefault(),!d.trim()||!t){n("Please enter a message");return}f(!0),n("");try{const a=await h.sendReply(t.id,{message:d});a.success?(j(""),S(t.id),u(),m("Message sent!"),setTimeout(()=>m(""),3e3)):n(a.message||"Failed to send message")}catch(a){console.error("Error sending message:",a),n("Failed to send message")}finally{f(!1)}},V=e=>{if(console.log("View Product clicked with ID:",e),e&&e!=="undefined"&&e!=="null"){const a=`/marketplace/product/${e}`;console.log("Navigating to:",a),B(a)}else console.error("Invalid product ID:",e),n("Product information is not available. The product may have been removed.")},b=e=>{const a=new Date(e),r=Math.abs(new Date-a),P=Math.ceil(r/(1e3*60*60*24));return P===1?"Yesterday":P>1?a.toLocaleDateString():a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return q?s.jsxs("div",{className:"messages-loading",children:[s.jsx(T,{size:"large"}),s.jsx("p",{children:"Loading messages..."})]}):s.jsxs("div",{className:"messages-page",children:[s.jsxs("div",{className:"messages-header",children:[s.jsx("h1",{children:"Messages"}),s.jsx(g,{variant:"outline",onClick:u,children:"Refresh"})]}),y&&s.jsx(E,{type:"error",onClose:()=>n(""),children:y}),_&&s.jsx(E,{type:"success",onClose:()=>m(""),children:_}),s.jsxs("div",{className:"messages-container",children:[s.jsxs("div",{className:"conversations-sidebar",children:[s.jsx("h3",{children:"Conversations"}),o.length===0?s.jsx(l,{className:"no-conversations",children:s.jsxs("div",{className:"no-conversations-content",children:[s.jsx("h4",{children:"No conversations yet"}),s.jsx("p",{children:"When buyers contact you about your products, conversations will appear here."})]})}):s.jsx("div",{className:"conversations-list",children:o.map(e=>{var a,c,r;return s.jsxs(l,{className:`conversation-item ${(t==null?void 0:t.id)===e.id?"active":""}`,onClick:()=>S(e.id),children:[s.jsxs("div",{className:"conversation-header",children:[s.jsxs("div",{className:"conversation-product",children:[s.jsx("strong",{children:((a=e.product_details)==null?void 0:a.title)||"Product"}),((c=e.product_details)==null?void 0:c.id)&&s.jsxs("small",{children:["ID: ",e.product_details.id]})]}),e.unread_count>0&&s.jsx("span",{className:"unread-badge",children:e.unread_count})]}),s.jsxs("div",{className:"conversation-parties",children:[s.jsxs("span",{className:"buyer",children:["Buyer: ",e.buyer_name||e.buyer_email]}),s.jsxs("span",{className:"seller",children:["Seller: ",e.seller_name||e.seller_email]})]}),e.last_message&&s.jsxs("div",{className:"last-message",children:[s.jsx("p",{children:e.last_message.content}),s.jsx("span",{className:"message-time",children:b(e.last_message.created_at)})]}),s.jsx("div",{className:"conversation-status",children:s.jsx("span",{className:`status status-${(r=e.status)==null?void 0:r.toLowerCase()}`,children:e.status})})]},e.id)})})]}),s.jsx("div",{className:"messages-area",children:t?s.jsxs(s.Fragment,{children:[s.jsxs(l,{className:"conversation-header-card",children:[s.jsxs("div",{className:"conversation-info",children:[s.jsx("h3",{children:((w=t.product_details)==null?void 0:w.title)||"Product"}),s.jsxs("div",{className:"conversation-meta",children:[s.jsxs("span",{children:["Buyer: ",t.buyer_name||t.buyer_email]}),s.jsxs("span",{children:["Seller: ",t.seller_name||t.seller_email]}),s.jsx("span",{className:`conversation-status status-${(C=t.status)==null?void 0:C.toLowerCase()}`,children:t.status}),((M=t.product_details)==null?void 0:M.id)&&s.jsxs("span",{className:"product-id",children:["Product ID: ",t.product_details.id]})]})]}),s.jsx(g,{variant:"outline",onClick:()=>{var e;return V((e=t.product_details)==null?void 0:e.id)},disabled:!((D=t.product_details)!=null&&D.id),children:(L=t.product_details)!=null&&L.id?"View Product":"Product Unavailable"})]}),s.jsx(l,{className:"messages-list-card",children:A?s.jsxs("div",{className:"messages-loading",children:[s.jsx(T,{size:"medium"}),s.jsx("p",{children:"Loading messages..."})]}):x.length===0?s.jsx("div",{className:"no-messages",children:s.jsx("p",{children:"No messages yet. Start the conversation!"})}):s.jsx("div",{className:"messages-list",children:x.map(e=>s.jsxs("div",{className:`message ${e.sender_email===t.seller_email?"sent":"received"}`,children:[s.jsxs("div",{className:"message-header",children:[s.jsx("span",{className:"sender-name",children:e.sender_name||e.sender_email}),s.jsx("span",{className:"message-time",children:b(e.created_at)})]}),s.jsxs("div",{className:"message-content",children:[s.jsx("p",{children:e.content}),e.message_type!=="TEXT"&&s.jsx("span",{className:"message-type",children:e.message_type}),e.quantity&&e.quantity>1&&s.jsxs("div",{className:"message-quantity",children:["Quantity: ",e.quantity]})]})]},e.id))})}),s.jsx(l,{className:"message-input-card",children:s.jsx("form",{onSubmit:R,className:"message-form",children:s.jsxs("div",{className:"message-input-container",children:[s.jsx(U,{value:d,onChange:e=>j(e.target.value),placeholder:"Type your message...",rows:3,disabled:N}),s.jsx(g,{type:"submit",variant:"primary",loading:N,disabled:!d.trim(),children:"Send"})]})})})]}):s.jsx(l,{className:"no-conversation-selected",children:s.jsxs("div",{className:"select-conversation-prompt",children:[s.jsx("h3",{children:"Select a conversation"}),s.jsx("p",{children:"Choose a conversation from the list to view and send messages."})]})})})]})]})};export{X as default};
//# sourceMappingURL=Messages-CpJQMAgX.js.map
