import{k as $,u as A,a as O,r as p,j as e,C as d,B as f,A as z,m as D}from"./index-C07V4r8E.js";import{I as t}from"./input-kLXWFfVH.js";const B=()=>{const{items:u,getCartTotal:m,clearCart:C,setShippingInfo:N,shippingInfo:P}=$(),{user:_,userProfile:n}=A(),x=O(),[b,j]=p.useState(!1),[y,c]=p.useState(""),[r,q]=p.useState({fullName:(n==null?void 0:n.first_name)+" "+(n==null?void 0:n.last_name)||"",address:"",city:"",state:"",zipCode:"",country:"United States",phone:"",cardNumber:"",expiryDate:"",cvv:"",cardName:"",notes:""}),s=a=>{q({...r,[a.target.name]:a.target.value})},S=()=>{var o;const a=["fullName","address","city","state","zipCode","phone","cardNumber","expiryDate","cvv","cardName"];for(let h of a)if(!((o=r[h])!=null&&o.trim()))return c(`Please fill in ${h.replace(/([A-Z])/g," $1").toLowerCase()}`),!1;return!0},I=async()=>{if(S()){j(!0),c("");try{const a={};u.forEach(l=>{a[l.sellerId]||(a[l.sellerId]=[]),a[l.sellerId].push(l)});const o=Object.entries(a).map(([l,v])=>{const k={seller_id:l,items:v.map(i=>({product_id:i.productId,quantity:i.quantity,price:i.price})),shipping_address:`${r.address}, ${r.city}, ${r.state} ${r.zipCode}, ${r.country}`,contact_number:r.phone,customer_notes:r.notes,total_price:v.reduce((i,g)=>i+g.price*g.quantity,0)};return D.createOrder(k)});(await Promise.all(o)).every(l=>l.success)?(N({fullName:r.fullName,address:r.address,city:r.city,state:r.state,zipCode:r.zipCode,country:r.country,phone:r.phone}),C(),x("/orders",{state:{message:"Order placed successfully! Sellers will confirm your orders shortly."}})):c("Some orders failed to process. Please try again.")}catch(a){console.error("Order creation error:",a),c("Failed to place order. Please try again.")}finally{j(!1)}}};return u.length===0?e.jsx("div",{className:"checkout-empty",children:e.jsx(d,{children:e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx("h2",{children:"Your cart is empty"}),e.jsx("p",{children:"Add some products to your cart before checkout"}),e.jsx(f,{variant:"primary",onClick:()=>x("/marketplace"),children:"Continue Shopping"})]})})}):e.jsxs("div",{className:"checkout-page",children:[e.jsx("h1",{children:"Checkout"}),y&&e.jsx(z,{type:"error",children:y}),e.jsxs("div",{className:"checkout-layout",children:[e.jsxs("div",{className:"checkout-form",children:[e.jsx(d,{title:"Shipping Information",children:e.jsxs("div",{className:"form-grid",children:[e.jsx(t,{label:"Full Name",name:"fullName",value:r.fullName,onChange:s,required:!0}),e.jsx(t,{label:"Address",name:"address",value:r.address,onChange:s,required:!0}),e.jsx(t,{label:"City",name:"city",value:r.city,onChange:s,required:!0}),e.jsx(t,{label:"State",name:"state",value:r.state,onChange:s,required:!0}),e.jsx(t,{label:"ZIP Code",name:"zipCode",value:r.zipCode,onChange:s,required:!0}),e.jsx(t,{label:"Phone Number",name:"phone",value:r.phone,onChange:s,required:!0})]})}),e.jsx(d,{title:"Payment Information",children:e.jsxs("div",{className:"form-grid",children:[e.jsx(t,{label:"Cardholder Name",name:"cardName",value:r.cardName,onChange:s,required:!0}),e.jsx(t,{label:"Card Number",name:"cardNumber",value:r.cardNumber,onChange:s,placeholder:"1234 5678 9012 3456",required:!0}),e.jsx(t,{label:"Expiry Date",name:"expiryDate",value:r.expiryDate,onChange:s,placeholder:"MM/YY",required:!0}),e.jsx(t,{label:"CVV",name:"cvv",value:r.cvv,onChange:s,required:!0})]})}),e.jsx(d,{title:"Order Notes (Optional)",children:e.jsx(t,{type:"textarea",name:"notes",value:r.notes,onChange:s,placeholder:"Any special instructions for the sellers...",rows:3})})]}),e.jsx("div",{className:"order-summary-sidebar",children:e.jsxs(d,{title:"Order Summary",children:[e.jsx("div",{className:"order-items",children:u.map(a=>e.jsxs("div",{className:"order-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("strong",{children:a.title}),e.jsxs("span",{children:["Qty: ",a.quantity]})]}),e.jsxs("div",{className:"item-price",children:["$",(a.price*a.quantity).toFixed(2)]})]},a.productId))}),e.jsxs("div",{className:"order-totals",children:[e.jsxs("div",{className:"total-line",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",m().toFixed(2)]})]}),e.jsxs("div",{className:"total-line",children:[e.jsx("span",{children:"Shipping:"}),e.jsx("span",{children:"$0.00"})]}),e.jsxs("div",{className:"total-line grand-total",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",m().toFixed(2)]})]})]}),e.jsx(f,{variant:"success",size:"large",loading:b,onClick:I,style:{width:"100%",marginTop:"20px"},children:"Place Order"})]})})]})]})};export{B as default};
//# sourceMappingURL=Checkout-VZ6Nrley.js.map
