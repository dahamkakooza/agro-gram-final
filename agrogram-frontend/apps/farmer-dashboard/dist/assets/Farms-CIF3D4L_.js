import{r as i,e as Q,a as W,f as F,j as a,b as X,B as c,C as v,d as f}from"./index-C07V4r8E.js";import{I as u}from"./input-kLXWFfVH.js";import{M as T}from"./Modal-EQcgVxp4.js";import{S as Z}from"./Select-CJWIEbcx.js";import{T as ee}from"./TextArea-Dt6jrW99.js";const ie=()=>{const[N,S]=i.useState([]),[I,P]=i.useState(!0),[z,g]=i.useState(!1),[Y,b]=i.useState(!1),[ae,q]=i.useState(null),[h,A]=i.useState({}),[y,_]=i.useState({}),[B,w]=i.useState(!1),[V,E]=i.useState(!1),[x,l]=i.useState(""),[s,m]=i.useState({name:"",location:"",total_area:"",soil_type:"",description:"",latitude:"",longitude:""}),[o,p]=i.useState({plot_number:"",area:"",current_crop:"",soil_ph:"",soil_moisture:"",farm:""}),[L]=Q(),O=W(),U=[{value:"LOAMY",label:"Loamy"},{value:"CLAY",label:"Clay"},{value:"SANDY",label:"Sandy"},{value:"SILTY",label:"Silty"},{value:"PEAT",label:"Peat"},{value:"CHALKY",label:"Chalky"}];i.useEffect(()=>{C();const e=L.get("action");e==="create"?g(!0):e==="add-crop"&&b(!0)},[L]);const C=async()=>{try{P(!0);const e=await F.getFarms();console.log("Farms API Response:",e);let r=[];e.success?e.data&&e.data.data&&Array.isArray(e.data.data.results)?r=e.data.data.results:e.data&&Array.isArray(e.data.results)?r=e.data.results:e.data&&Array.isArray(e.data)||Array.isArray(e.data)?r=e.data:e.data&&e.data.data&&Array.isArray(e.data.data)?r=e.data.data:(console.warn("Unexpected farms response structure:",e),r=[]):(l(e.message||"Failed to load farms"),r=[]),S(r)}catch(e){console.error("Error fetching farms:",e),l("Failed to load farms. Please try again."),S([])}finally{P(!1)}},H=async e=>{e.preventDefault(),w(!0),A({}),l("");try{const r={...s,total_area:s.total_area?parseFloat(s.total_area):void 0,latitude:s.latitude?parseFloat(s.latitude):void 0,longitude:s.longitude?parseFloat(s.longitude):void 0},t=await F.createFarm(r);t.success?(g(!1),m({name:"",location:"",total_area:"",soil_type:"",description:"",latitude:"",longitude:""}),C()):f.isValidationError(t)?A(f.getFieldErrors(t)):l(f.formatErrorForDisplay(t))}catch(r){console.error("Error creating farm:",r),l("Failed to create farm. Please try again.")}finally{w(!1)}},R=async e=>{e.preventDefault(),E(!0),_({}),l("");try{const r={...o,area:o.area?parseFloat(o.area):void 0,soil_ph:o.soil_ph?parseFloat(o.soil_ph):void 0,soil_moisture:o.soil_moisture?parseFloat(o.soil_moisture):void 0,farm:parseInt(o.farm)},t=await F.createPlot(r);t.success?(b(!1),p({plot_number:"",area:"",current_crop:"",soil_ph:"",soil_moisture:"",farm:""}),C()):f.isValidationError(t)?_(f.getFieldErrors(t)):l(f.formatErrorForDisplay(t))}catch(r){console.error("Error creating plot:",r),l("Failed to create plot. Please try again.")}finally{E(!1)}},$=async e=>{if(window.confirm("Are you sure you want to delete this farm? This action cannot be undone."))try{const r=await F.deleteFarm(e);r.success?C():l(r.message||"Failed to delete farm")}catch(r){console.error("Error deleting farm:",r),l("Failed to delete farm. Please try again.")}},G=e=>{O(`/farms/${e}`)},K=e=>{q(e),p(r=>({...r,farm:e.toString()})),_({}),b(!0)},D=()=>{g(!1),m({name:"",location:"",total_area:"",soil_type:"",description:"",latitude:"",longitude:""}),A({})},k=()=>{b(!1),p({plot_number:"",area:"",current_crop:"",soil_ph:"",soil_moisture:"",farm:""}),_({})},n=(e,r)=>r[e]?r[e][0]:"",J=e=>e?Array.isArray(e.plots)?e.plots:Array.isArray(e.plots_list)?e.plots_list:Array.isArray(e.plot_set)?e.plot_set:[]:[],d=(e,r,t="")=>e&&e[r]!==void 0?e[r]:t;if(I)return a.jsxs("div",{className:"loading",children:[a.jsx(X,{size:"large"}),a.jsx("p",{children:"Loading farms..."})]});const M=Array.isArray(N)?N:[];return a.jsxs("div",{className:"farms-page",children:[a.jsxs("div",{className:"farms-header",children:[a.jsx("h1",{children:"My Farms"}),a.jsx(c,{variant:"primary",onClick:()=>g(!0),children:"Add New Farm"})]}),x&&a.jsx(v,{className:"alert-error",style:{marginBottom:"16px",background:"#ffebee",borderColor:"#f44336"},children:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:x}),a.jsx(c,{size:"small",variant:"text",onClick:()=>l(""),children:"×"})]})}),M.length===0?a.jsx(v,{className:"no-farms-card",children:a.jsxs("div",{className:"no-farms-content",children:[a.jsx("h3",{children:"No Farms Yet"}),a.jsx("p",{children:"Start by creating your first farm to manage your agricultural operations."}),a.jsx(c,{variant:"primary",onClick:()=>g(!0),children:"Create Your First Farm"})]})}):a.jsx("div",{className:"farms-grid",children:M.map(e=>{const r=J(e),t=r.length;return a.jsxs(v,{className:"farm-card",children:[a.jsxs("div",{className:"farm-card__header",children:[a.jsx("h3",{children:d(e,"name","Unnamed Farm")}),a.jsxs("div",{className:"farm-actions",children:[a.jsx(c,{size:"small",variant:"outline",onClick:()=>G(e.id),children:"View"}),a.jsx(c,{size:"small",variant:"outline",onClick:()=>K(e.id),children:"Add Plot"}),a.jsx(c,{size:"small",variant:"danger",onClick:()=>$(e.id),children:"Delete"})]})]}),a.jsxs("div",{className:"farm-card__info",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Location:"})," ",d(e,"location","Not specified")]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Area:"})," ",d(e,"total_area",0)," acres"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Soil Type:"})," ",d(e,"soil_type_display")||d(e,"soil_type","Not specified")]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Plots:"})," ",t]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Productivity:"}),a.jsx("span",{className:`productivity-badge productivity-${(d(e,"productivity_level","medium")||"medium").toLowerCase()}`,children:d(e,"productivity_level","Medium")})]})]}),t>0&&a.jsxs("div",{className:"farm-plots",children:[a.jsx("h4",{children:"Plots"}),r.slice(0,3).map(j=>a.jsxs("div",{className:"plot-item",children:[a.jsxs("span",{children:["Plot ",d(j,"plot_number","N/A")," - ",d(j,"area",0)," acres"]}),j.current_crop&&a.jsx("span",{className:"crop-badge",children:d(j,"current_crop")})]},j.id)),t>3&&a.jsxs("p",{className:"more-plots",children:["+",t-3," more plots"]})]})]},e.id)})}),a.jsx(T,{isOpen:z,onClose:D,title:"Create New Farm",children:a.jsxs("form",{onSubmit:H,className:"farm-form",children:[x&&a.jsx(v,{className:"alert-error",style:{marginBottom:"16px",background:"#ffebee",borderColor:"#f44336"},children:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:x}),a.jsx(c,{size:"small",variant:"text",onClick:()=>l(""),children:"×"})]})}),a.jsx(u,{label:"Farm Name",value:s.name,onChange:e=>m(r=>({...r,name:e.target.value})),error:n("name",h),required:!0}),a.jsx(u,{label:"Location",value:s.location,onChange:e=>m(r=>({...r,location:e.target.value})),error:n("location",h),required:!0}),a.jsx(u,{label:"Total Area (acres)",type:"number",step:"0.01",min:"0.01",value:s.total_area,onChange:e=>m(r=>({...r,total_area:e.target.value})),error:n("total_area",h),required:!0}),a.jsx(Z,{label:"Soil Type",options:U,value:s.soil_type,onChange:e=>m(r=>({...r,soil_type:e.target.value})),error:n("soil_type",h)}),a.jsx(ee,{label:"Description",value:s.description,onChange:e=>m(r=>({...r,description:e.target.value})),error:n("description",h),rows:3}),a.jsxs("div",{className:"form-row",children:[a.jsx(u,{label:"Latitude",type:"number",step:"0.000001",min:"-90",max:"90",value:s.latitude,onChange:e=>m(r=>({...r,latitude:e.target.value})),error:n("latitude",h)}),a.jsx(u,{label:"Longitude",type:"number",step:"0.000001",min:"-180",max:"180",value:s.longitude,onChange:e=>m(r=>({...r,longitude:e.target.value})),error:n("longitude",h)})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx(c,{type:"button",variant:"outline",onClick:D,children:"Cancel"}),a.jsx(c,{type:"submit",variant:"primary",loading:B,children:"Create Farm"})]})]})}),a.jsx(T,{isOpen:Y,onClose:k,title:"Add New Plot",children:a.jsxs("form",{onSubmit:R,className:"plot-form",children:[x&&a.jsx(v,{className:"alert-error",style:{marginBottom:"16px",background:"#ffebee",borderColor:"#f44336"},children:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:x}),a.jsx(c,{size:"small",variant:"text",onClick:()=>l(""),children:"×"})]})}),a.jsx(u,{label:"Plot Number",value:o.plot_number,onChange:e=>p(r=>({...r,plot_number:e.target.value})),error:n("plot_number",y),required:!0}),a.jsx(u,{label:"Area (acres)",type:"number",step:"0.01",min:"0.01",value:o.area,onChange:e=>p(r=>({...r,area:e.target.value})),error:n("area",y),required:!0}),a.jsx(u,{label:"Current Crop",value:o.current_crop,onChange:e=>p(r=>({...r,current_crop:e.target.value})),error:n("current_crop",y)}),a.jsxs("div",{className:"form-row",children:[a.jsx(u,{label:"Soil pH",type:"number",step:"0.1",min:"0",max:"14",value:o.soil_ph,onChange:e=>p(r=>({...r,soil_ph:e.target.value})),error:n("soil_ph",y)}),a.jsx(u,{label:"Soil Moisture %",type:"number",step:"0.1",min:"0",max:"100",value:o.soil_moisture,onChange:e=>p(r=>({...r,soil_moisture:e.target.value})),error:n("soil_moisture",y)})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx(c,{type:"button",variant:"outline",onClick:k,children:"Cancel"}),a.jsx(c,{type:"submit",variant:"primary",loading:V,children:"Add Plot"})]})]})})]})};export{ie as default};
//# sourceMappingURL=Farms-CIF3D4L_.js.map
