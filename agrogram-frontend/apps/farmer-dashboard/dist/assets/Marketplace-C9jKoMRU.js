import{r as n,a as la,m as k,t as G,c as De,j as e,b as Y,B as u,A as le,C as h,p as na,d as ca}from"./index-C07V4r8E.js";import{I as g}from"./input-kLXWFfVH.js";import{M as F}from"./Modal-EQcgVxp4.js";import{S as C}from"./Select-CJWIEbcx.js";import{T as oa}from"./Tabs-xtqnmJ3V.js";import{T as ne}from"./TextArea-Dt6jrW99.js";const ya=()=>{var we,Pe,Se,Te,qe,Ae,Ee,Le,Me;const[P,H]=n.useState([]),[D,B]=n.useState([]),[j,Ie]=n.useState(null),[Re,ce]=n.useState(!0),[b,oe]=n.useState(""),[d,S]=n.useState({category:"",price_min:"",price_max:"",quality:"",location:""}),[Q,I]=n.useState(!1),[Oe,K]=n.useState(!1),[c,y]=n.useState({title:"",description:"",category:"",price:"",quantity:"",unit:"KG",quality_grade:"STANDARD",location:"",image:null}),[de,Ue]=n.useState([]),[ue,me]=n.useState(!1),[ze,A]=n.useState(!1),[f,w]=n.useState({title:"",description:"",task_type:"OTHER",priority:"MEDIUM",due_date:"",estimated_hours:1}),[$e,he]=n.useState(!1),[m,V]=n.useState(null),[T,R]=n.useState({cropType:"",market:"",predictionPeriod:"1 Month",useGlobal:!1}),[N,Ge]=n.useState("browse"),[ge,t]=n.useState(""),[pe,p]=n.useState(""),[xe,E]=n.useState(""),[Ye,je]=n.useState(!1),[W,ye]=n.useState(!1),[Z,ve]=n.useState(!1),[J,X]=n.useState([]),[r,fe]=n.useState(null),[He,O]=n.useState(!1),[Be,L]=n.useState(!1),[_,U]=n.useState({message:"",quantity:1});la(),n.useEffect(()=>{z(),Ne()},[]),n.useEffect(()=>{N==="tasks"&&$()},[N]),n.useEffect(()=>{N==="personalized"&&J.length===0&&se()},[N]),n.useEffect(()=>{Q&&D.length===0&&Ne()},[Q]);const Ne=async()=>{try{console.log("ðŸ“‹ Fetching categories from API...");const a=await k.getCategories();if(a.success&&a.data){const i=(Array.isArray(a.data)?a.data:a.data.categories||[]).map(l=>({value:l.id?l.id.toString():l.value,label:l.name||l.label}));console.log("âœ… Categories loaded:",i),B(i)}else console.warn("âš ï¸ Categories API failed, extracting from products"),ee()}catch(a){console.error("âŒ Error fetching categories:",a),ee()}},ee=()=>{try{const a=P||[],s=new Map;console.log("Extracting categories from products:",a.length),a.forEach(l=>{if(l.category&&typeof l.category=="object")l.category.id&&l.category.name&&s.set(l.category.id.toString(),l.category.name);else if(l.category_name){const o=l.category_name.toLowerCase().replace(/\s+/g,"_");s.set(o,l.category_name)}}),s.size===0&&(console.log("No categories found in products, adding defaults"),[{id:"1",name:"Grains"},{id:"2",name:"Vegetables"},{id:"3",name:"Fruits"},{id:"4",name:"Livestock"},{id:"5",name:"Dairy"}].forEach(o=>{s.set(o.id,o.name)}));const i=Array.from(s.entries()).map(([l,o])=>({value:l,label:o}));console.log("Categories extracted:",i),B(i)}catch(a){console.error("Error extracting categories:",a),B([{value:"1",label:"Grains"},{value:"2",label:"Vegetables"},{value:"3",label:"Fruits"},{value:"4",label:"Livestock"},{value:"5",label:"Dairy"}])}},z=async()=>{ce(!0),t("");try{const a=await k.getProducts();if(a.success){const s=a.data.results||a.data||[];H(s),D.length===0&&ee()}else t(a.message||"Failed to load products");try{const s=await k.getMarketAnalytics();s.success?Ie(s.data.analytics||s.data):console.warn("Analytics API failed, continuing without analytics")}catch(s){console.warn("Analytics unavailable:",s.message)}}catch(a){console.error("Error fetching marketplace data:",a),t("Failed to load marketplace data. Please try again.")}finally{ce(!1)}},$=async()=>{me(!0);try{const a=await G.getAll();a.success?Ue(a.data.tasks||a.data||[]):t(a.message||"Failed to load tasks")}catch(a){console.error("Error fetching tasks:",a),t("Failed to load tasks")}finally{me(!1)}},Qe=async a=>{var s,i,l;a.preventDefault(),K(!0),t("");try{if(!((s=c.title)!=null&&s.trim())||!c.price||!c.quantity||!c.category){t("Please fill in all required fields (Title, Price, Quantity, Category)"),K(!1);return}const o=new FormData;o.append("title",c.title.trim()),o.append("description",((i=c.description)==null?void 0:i.trim())||"No description provided"),o.append("category",c.category),o.append("price",parseFloat(c.price)),o.append("quantity",parseInt(c.quantity)),o.append("unit",c.unit||"KG"),o.append("quality_grade",c.quality_grade||"STANDARD"),(l=c.location)!=null&&l.trim()&&o.append("location",c.location.trim()),c.image&&o.append("image",c.image),console.log("ðŸ“¦ Creating product with data:"),console.log("   Title:",c.title),console.log("   Category:",c.category),console.log("   Price:",c.price),console.log("   Quantity:",c.quantity),console.log("ðŸ” FormData contents:");for(let[q,v]of o.entries())console.log(`   ${q}:`,v);const x=await na.create(o);if(x.success)I(!1),y({title:"",description:"",category:"",price:"",quantity:"",unit:"KG",quality_grade:"STANDARD",location:"",image:null}),z(),p("Product listed successfully!"),setTimeout(()=>p(""),5e3);else if(x.details){const q=Object.values(x.details).flat().join(", ");t(q||x.message||"Failed to list product")}else t(x.message||"Failed to list product")}catch(o){console.error("Error selling product:",o),t("Failed to list product. Please try again.")}finally{K(!1)}},Ke=async a=>{a.preventDefault(),t("");try{if(!f.title){t("Task title is required");return}const s=await G.create(f);s.success?(A(!1),w({title:"",description:"",task_type:"OTHER",priority:"MEDIUM",due_date:"",estimated_hours:1}),$(),p("Task created successfully!"),setTimeout(()=>p(""),5e3)):t(s.message||"Failed to create task")}catch(s){console.error("Error creating task:",s),t("Failed to create task")}},Ve=async a=>{try{const s=await G.complete(a);s.success?($(),p("Task marked as completed!"),setTimeout(()=>p(""),5e3)):t(s.message||"Failed to complete task")}catch(s){console.error("Error completing task:",s),t("Failed to complete task")}},We=async a=>{if(window.confirm("Are you sure you want to delete this task?"))try{const s=await G.delete(a);s.success?($(),p("Task deleted successfully!"),setTimeout(()=>p(""),5e3)):t(s.message||"Failed to delete task")}catch(s){console.error("Error deleting task:",s),t("Failed to delete task")}},Ze=a=>{const s=a.target.files[0];if(s){const i=ca.validateFile(s);i.valid?y(l=>({...l,image:s})):t(i.errors[0])}},Je=async a=>{a.preventDefault(),ye(!0),t("");try{const s=await k.searchProducts(b,d);s.success?H(s.data.search_results||s.data||[]):(t(s.message||"Search failed"),Ce())}catch(s){console.error("Error searching products:",s),t("Search failed. Using basic filtering."),Ce()}finally{ye(!1)}},Ce=()=>{const a=P.filter(s=>{var i,l,o;return!(d.category&&ae(s)!==d.category||d.price_min&&s.price<parseFloat(d.price_min)||d.price_max&&s.price>parseFloat(d.price_max)||d.quality&&s.quality_grade!==d.quality||d.location&&!((i=s.location)!=null&&i.toLowerCase().includes(d.location.toLowerCase()))||b&&!((l=s.title)!=null&&l.toLowerCase().includes(b.toLowerCase()))&&!((o=s.description)!=null&&o.toLowerCase().includes(b.toLowerCase())))});H(a)},ae=a=>typeof a.category=="object"&&a.category.name?a.category.name:a.category_name||"",se=async()=>{ve(!0),t("");try{const a=await k.getPersonalizedProducts();a.success?X(a.data.personalized_recommendations||[]):(t(a.message||"Failed to refresh recommendations"),X(P.slice(0,10)))}catch(a){console.error("Error refreshing recommendations:",a),t("Failed to refresh recommendations. Showing general products."),X(P.slice(0,10))}finally{ve(!1)}},Xe=async a=>{a.preventDefault(),je(!0),E(""),V(null);try{const s=await k.getPricePrediction(T);s.success?V(s.data):E(s.message||"Failed to get price prediction")}catch(s){console.error("Error getting price prediction:",s),E("Failed to get price prediction. Please try again.")}finally{je(!1)}},be=()=>{S({category:"",price_min:"",price_max:"",quality:"",location:""}),oe(""),t(""),z()},ea=()=>{he(!1),V(null),E(""),R({cropType:"",market:"",predictionPeriod:"1 Month",useGlobal:!1})},M=a=>{try{const s=window.getAuth?window.getAuth():null,i=s==null?void 0:s.currentUser;return!i||!a.farmer_email?!1:i.email===a.farmer_email}catch(s){return console.error("Error checking product ownership:",s),!1}},te=async()=>{try{let a=null;typeof window.getAuth=="function"?a=window.getAuth():window.auth?a=window.auth:window.firebase&&window.firebase.auth&&(a=window.firebase.auth());const s=a==null?void 0:a.currentUser;if(s){console.log("âœ… User is authenticated:",s.email);try{const i=await s.getIdToken(!0);localStorage.setItem("firebaseToken",i),console.log("âœ… Token refreshed and stored")}catch{console.warn("âš ï¸ Could not refresh token, using existing one")}return!0}else return console.warn("âŒ User is not authenticated"),localStorage.getItem("firebaseToken")?(console.log("ðŸ”„ Using stored token from localStorage"),!0):!1}catch(a){return console.error("Error checking authentication:",a),!1}},_e=a=>{fe(a),O(!0)},re=async a=>{if(!await te()){t("Please log in to contact sellers");return}if(M(a)){t("You cannot message yourself. This is your own product listing.");return}fe(a),U({message:`Hi, I'm interested in your "${a.title}" listed for $${a.price}. Could you provide more details?`,quantity:1}),L(!0)},aa=async a=>{var i,l,o,x,q;if(a.preventDefault(),!_.message.trim()){t("Please enter a message");return}if(!await te()){t("Please log in to send messages");return}if(M(r)){t("You cannot message yourself. This is your own product listing.");return}try{const v={product_id:r.id,message:_.message,quantity:_.quantity,message_type:"INQUIRY"};console.log("ðŸ“§ Sending message to seller:",v);const Fe=await De.sendMessage(v);Fe.success?(L(!1),p(`Message sent to ${r.farmer_email||"the seller"}!`),setTimeout(()=>p(""),5e3),U({message:"",quantity:1})):t(Fe.message||"Failed to send message. Please try again.")}catch(v){console.error("Error sending message:",v),((i=v.response)==null?void 0:i.status)===400&&((o=(l=v.response)==null?void 0:l.data)==null?void 0:o.error)==="You cannot message yourself"?t("You cannot message yourself. This is your own product listing."):((x=v.response)==null?void 0:x.status)===403?t("Authentication failed. Please log in again."):((q=v.response)==null?void 0:q.status)===401?t("Session expired. Please log in again."):t("Failed to send message. Please try again.")}},sa=async()=>{if(!r)return;if(!await te()){t("Please log in to create orders");return}try{const s={product:r.id,quantity:_.quantity,total_price:(r.price*_.quantity).toFixed(2),shipping_address:"To be provided",contact_number:"To be provided"};console.log("ðŸ›’ Creating order:",s);const i=await k.createOrder(s);i.success?(L(!1),p(`Order created successfully for ${r.title}!`),setTimeout(()=>p(""),5e3)):t(i.message||"Failed to create order")}catch(s){console.error("Error creating order:",s),t("Failed to create order. Please try again.")}},ke=P.filter(a=>{var s,i,l;return!(d.category&&ae(a)!==d.category||d.price_min&&a.price<parseFloat(d.price_min)||d.price_max&&a.price>parseFloat(d.price_max)||d.quality&&a.quality_grade!==d.quality||d.location&&!((s=a.location)!=null&&s.toLowerCase().includes(d.location.toLowerCase()))||b&&!((i=a.title)!=null&&i.toLowerCase().includes(b.toLowerCase()))&&!((l=a.description)!=null&&l.toLowerCase().includes(b.toLowerCase())))}),[da,ta]=n.useState(0);n.useEffect(()=>{ra()},[]);const ra=async()=>{try{const a=await De.getNotifications();a.success&&ta(a.data.unread_count||0)}catch(a){console.error("Error checking messages:",a)}},[ua,ia]=n.useState(0);n.useEffect(()=>{(async()=>{try{const s=await k.getOrders();if(s.success){const l=(s.data.results||s.data||[]).filter(o=>o.seller_type==="USER"&&o.status==="PENDING").length;ia(l)}}catch(s){console.error("Error fetching notifications:",s)}})()},[]);const ie=a=>ae(a)||"Unknown Category";return Re&&P.length===0?e.jsxs("div",{className:"loading-container",children:[e.jsx(Y,{size:"large"}),e.jsx("p",{children:"Loading marketplace..."})]}):e.jsxs("div",{className:"marketplace",children:[e.jsxs("div",{className:"marketplace__header",children:[e.jsx("h1",{children:"Agricultural Marketplace"}),e.jsxs("div",{className:"marketplace__actions",children:[e.jsx(u,{variant:"outline",onClick:()=>he(!0),children:"Price Predictions"}),e.jsx(u,{variant:"primary",onClick:()=>I(!0),children:"Sell Product"})]})]}),ge&&e.jsx(le,{type:"error",onClose:()=>t(""),children:ge}),pe&&e.jsx(le,{type:"success",onClose:()=>p(""),children:pe}),e.jsx(oa,{tabs:[{id:"browse",label:"Browse Products"},{id:"analytics",label:"Market Analytics"},{id:"personalized",label:"For You"},{id:"tasks",label:"My Tasks"}],activeTab:N,onChange:Ge}),N==="browse"&&e.jsxs("div",{className:"marketplace__content",children:[e.jsx(h,{className:"search-filters",children:e.jsxs("form",{onSubmit:Je,className:"search-form",children:[e.jsxs("div",{className:"search-bar",children:[e.jsx(g,{placeholder:"Search products...",value:b,onChange:a=>oe(a.target.value),className:"search-input"}),e.jsx(u,{type:"submit",variant:"primary",loading:W,children:"Search"})]}),e.jsxs("div",{className:"filters-grid",children:[e.jsx(C,{options:[{value:"",label:"All Categories"},...D],value:d.category,onChange:a=>S(s=>({...s,category:a.target.value}))}),e.jsx(g,{type:"number",placeholder:"Min Price",value:d.price_min,onChange:a=>S(s=>({...s,price_min:a.target.value})),min:"0",step:"0.01"}),e.jsx(g,{type:"number",placeholder:"Max Price",value:d.price_max,onChange:a=>S(s=>({...s,price_max:a.target.value})),min:"0",step:"0.01"}),e.jsx(C,{options:[{value:"",label:"All Quality"},{value:"PREMIUM",label:"Premium"},{value:"STANDARD",label:"Standard"},{value:"ECONOMY",label:"Economy"}],value:d.quality,onChange:a=>S(s=>({...s,quality:a.target.value}))}),e.jsx(g,{placeholder:"Location",value:d.location,onChange:a=>S(s=>({...s,location:a.target.value}))}),e.jsx(u,{type:"button",variant:"outline",onClick:be,children:"Clear Filters"})]})]})}),W?e.jsxs("div",{className:"loading-container",children:[e.jsx(Y,{size:"medium"}),e.jsx("p",{children:"Searching products..."})]}):e.jsx("div",{className:"products-grid",children:ke.map(a=>{var s,i,l,o,x;return e.jsxs(h,{className:"product-card",children:[e.jsx("div",{className:"product-card__image",children:a.image?e.jsx("img",{src:a.image,alt:a.title}):e.jsx("div",{className:"product-image-placeholder",children:"ðŸŒ±"})}),e.jsxs("div",{className:"product-card__content",children:[e.jsxs("div",{className:"product-header",children:[e.jsx("h3",{children:a.title||"Untitled Product"}),a.quality_grade&&e.jsx("span",{className:`quality-badge quality-${(s=a.quality_grade)==null?void 0:s.toLowerCase()}`,children:a.quality_grade})]}),e.jsx("div",{className:"product-category",children:e.jsxs("small",{children:["Category: ",ie(a)]})}),e.jsx("p",{className:"product-description",children:a.description||"No description available"}),e.jsxs("div",{className:"product-meta",children:[e.jsxs("span",{className:"product-price",children:["$",a.price||"N/A"]}),e.jsxs("span",{className:"product-quantity",children:[a.quantity||"0"," ",a.unit||"units"]}),e.jsx("span",{className:"product-location",children:a.location||"Location not specified"})]}),e.jsx("div",{className:"product-seller",children:e.jsxs("small",{children:["By: ",a.farmer_email||"Unknown seller"]})}),a.market_insights&&e.jsx("div",{className:"market-insights",children:((i=a.demand_level)==null?void 0:i.level)&&e.jsxs("div",{className:`demand-badge demand-${(o=(l=a.demand_level)==null?void 0:l.level)==null?void 0:o.toLowerCase()}`,children:[(x=a.demand_level)==null?void 0:x.level," Demand"]})}),e.jsxs("div",{className:"product-actions",children:[e.jsx(u,{variant:"outline",size:"small",onClick:()=>_e(a),children:"View Details"}),!M(a)&&e.jsx(u,{variant:"primary",size:"small",onClick:()=>re(a),children:"Contact Seller"})]})]})]},a.id)})}),ke.length===0&&!W&&e.jsx(h,{className:"no-products",children:e.jsxs("div",{className:"no-products-content",children:[e.jsx("h3",{children:"No products found"}),e.jsx("p",{children:"Try adjusting your search criteria or clear filters."}),e.jsx(u,{variant:"outline",onClick:be,children:"Clear Filters"})]})})]}),N==="analytics"&&e.jsx("div",{className:"marketplace__content",children:j?e.jsxs("div",{className:"analytics-grid",children:[e.jsx(h,{title:"Market Overview",children:e.jsxs("div",{className:"stats-row",children:[e.jsxs("div",{className:"stat",children:[e.jsx("h3",{children:j.total_products||0}),e.jsx("p",{children:"Total Products"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("h3",{children:j.active_products||0}),e.jsx("p",{children:"Active Listings"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("h3",{children:j.total_orders||0}),e.jsx("p",{children:"Total Orders"})]}),e.jsxs("div",{className:"stat",children:[e.jsxs("h3",{children:[((j.avg_demand_score||0)*100).toFixed(1),"%"]}),e.jsx("p",{children:"Avg Demand"})]})]})}),e.jsx(h,{title:"Price Trends",children:e.jsx("div",{className:"trends-list",children:((we=j.price_movements)==null?void 0:we.length)>0?j.price_movements.map((a,s)=>e.jsxs("div",{className:"trend-item",children:[e.jsx("span",{className:"trend-product",children:a.title}),e.jsxs("span",{className:`trend-value ${a.price_trend>0?"trend-up":"trend-down"}`,children:[a.price_trend>0?"â†—":"â†˜"," ",Math.abs(a.price_trend),"%"]})]},s)):e.jsx("p",{className:"no-data",children:"No price trend data available"})})}),e.jsx(h,{title:"Popular Categories",children:e.jsx("div",{className:"categories-list",children:((Pe=j.popular_categories)==null?void 0:Pe.length)>0?j.popular_categories.map((a,s)=>e.jsxs("div",{className:"category-item",children:[e.jsx("span",{className:"category-name",children:a.category__name}),e.jsxs("span",{className:"category-count",children:[a.product_count," products"]}),e.jsxs("span",{className:"category-demand",children:[((a.avg_demand||0)*100).toFixed(1),"% demand"]})]},s)):e.jsx("p",{className:"no-data",children:"No category data available"})})}),e.jsx(h,{title:"Regional Insights",children:e.jsx("div",{className:"regions-list",children:((Se=j.regional_insights)==null?void 0:Se.length)>0?j.regional_insights.map((a,s)=>e.jsxs("div",{className:"region-item",children:[e.jsx("span",{className:"region-name",children:a.location}),e.jsxs("span",{className:"region-stats",children:[a.product_count," products â€¢ $",a.avg_price]})]},s)):e.jsx("p",{className:"no-data",children:"No regional data available"})})})]}):e.jsx(h,{children:e.jsxs("div",{className:"no-analytics",children:[e.jsx("h3",{children:"Analytics Unavailable"}),e.jsx("p",{children:"Market analytics are currently not available. Please try again later."}),e.jsx(u,{variant:"outline",onClick:z,children:"Retry"})]})})}),N==="personalized"&&e.jsxs("div",{className:"marketplace__content",children:[e.jsx(h,{children:e.jsxs("div",{className:"personalized-content",children:[e.jsx("h3",{children:"Personalized Recommendations"}),e.jsx("p",{children:"Based on your preferences and browsing history"}),e.jsx(u,{variant:"primary",onClick:se,loading:Z,children:"Refresh Recommendations"})]})}),Z?e.jsxs("div",{className:"loading-container",children:[e.jsx(Y,{size:"medium"}),e.jsx("p",{children:"Loading personalized recommendations..."})]}):e.jsx("div",{className:"products-grid",children:J.map(a=>{var s;return e.jsxs(h,{className:"product-card",children:[e.jsx("div",{className:"product-card__image",children:a.image?e.jsx("img",{src:a.image,alt:a.title}):e.jsx("div",{className:"product-image-placeholder",children:"ðŸŒ±"})}),e.jsxs("div",{className:"product-card__content",children:[e.jsxs("div",{className:"product-header",children:[e.jsx("h3",{children:a.title||"Untitled Product"}),a.quality_grade&&e.jsx("span",{className:`quality-badge quality-${(s=a.quality_grade)==null?void 0:s.toLowerCase()}`,children:a.quality_grade})]}),e.jsx("div",{className:"product-category",children:e.jsxs("small",{children:["Category: ",ie(a)]})}),e.jsx("p",{className:"product-description",children:a.description||"No description available"}),e.jsxs("div",{className:"product-meta",children:[e.jsxs("span",{className:"product-price",children:["$",a.price||"N/A"]}),e.jsxs("span",{className:"product-quantity",children:[a.quantity||"0"," ",a.unit||"units"]}),e.jsx("span",{className:"product-location",children:a.location||"Location not specified"})]}),e.jsx("div",{className:"product-seller",children:e.jsxs("small",{children:["By: ",a.farmer_email||"Unknown seller"]})}),e.jsx("div",{className:"recommendation-badge",children:e.jsx("span",{className:"badge",children:"Recommended for you"})}),e.jsxs("div",{className:"product-actions",children:[e.jsx(u,{variant:"outline",size:"small",onClick:()=>_e(a),children:"View Details"}),!M(a)&&e.jsx(u,{variant:"primary",size:"small",onClick:()=>re(a),children:"Contact Seller"})]})]})]},a.id)})}),J.length===0&&!Z&&e.jsx(h,{className:"no-products",children:e.jsxs("div",{className:"no-products-content",children:[e.jsx("h3",{children:"No personalized recommendations yet"}),e.jsx("p",{children:"Refresh recommendations or browse more products to get personalized suggestions."}),e.jsx(u,{variant:"outline",onClick:se,children:"Refresh Recommendations"})]})})]}),N==="tasks"&&e.jsxs("div",{className:"marketplace__content",children:[e.jsx(h,{children:e.jsxs("div",{className:"tasks-header",children:[e.jsx("h3",{children:"My Tasks"}),e.jsx(u,{variant:"primary",onClick:()=>A(!0),children:"Add New Task"})]})}),ue?e.jsxs("div",{className:"loading-container",children:[e.jsx(Y,{size:"medium"}),e.jsx("p",{children:"Loading tasks..."})]}):e.jsx("div",{className:"tasks-list",children:de.map(a=>{var s,i;return e.jsx(h,{className:"task-card",children:e.jsxs("div",{className:"task-content",children:[e.jsxs("div",{className:"task-header",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:`priority-badge priority-${(s=a.priority)==null?void 0:s.toLowerCase()}`,children:a.priority})]}),a.description&&e.jsx("p",{className:"task-description",children:a.description}),e.jsxs("div",{className:"task-meta",children:[e.jsx("span",{className:`status-badge status-${(i=a.status)==null?void 0:i.toLowerCase()}`,children:a.status}),a.due_date&&e.jsxs("span",{className:"due-date",children:["Due: ",new Date(a.due_date).toLocaleDateString()]}),a.completed_at&&e.jsxs("span",{className:"completed-date",children:["Completed: ",new Date(a.completed_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"task-actions",children:[a.status!=="COMPLETED"&&e.jsx(u,{variant:"outline",size:"small",onClick:()=>Ve(a.id),children:"Mark Complete"}),e.jsx(u,{variant:"text",size:"small",onClick:()=>We(a.id),children:"Delete"})]})]})},a.id)})}),de.length===0&&!ue&&e.jsx(h,{className:"no-tasks",children:e.jsxs("div",{className:"no-tasks-content",children:[e.jsx("h3",{children:"No tasks yet"}),e.jsx("p",{children:"Create your first task to get started with managing your agricultural activities."}),e.jsx(u,{variant:"primary",onClick:()=>A(!0),children:"Create Your First Task"})]})})]}),e.jsx(F,{isOpen:Q,onClose:()=>I(!1),title:"Sell Your Product",size:"large",children:e.jsxs("form",{onSubmit:Qe,className:"sell-product-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsx(g,{label:"Product Title *",value:c.title,onChange:a=>y(s=>({...s,title:a.target.value})),required:!0}),e.jsx(C,{label:"Category *",options:[{value:"",label:"Select Category"},...D],value:c.category,onChange:a=>y(s=>({...s,category:a.target.value})),required:!0})]}),e.jsx(ne,{label:"Description *",value:c.description,onChange:a=>y(s=>({...s,description:a.target.value})),rows:3,required:!0}),e.jsxs("div",{className:"form-row",children:[e.jsx(g,{label:"Price *",type:"number",step:"0.01",min:"0.01",value:c.price,onChange:a=>y(s=>({...s,price:a.target.value})),required:!0}),e.jsx(g,{label:"Quantity *",type:"number",min:"1",value:c.quantity,onChange:a=>y(s=>({...s,quantity:a.target.value})),required:!0}),e.jsx(C,{label:"Unit",options:[{value:"KG",label:"Kilogram"},{value:"LB",label:"Pound"},{value:"TON",label:"Ton"},{value:"SACK",label:"Sack"},{value:"PIECE",label:"Piece"}],value:c.unit,onChange:a=>y(s=>({...s,unit:a.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(C,{label:"Quality Grade",options:[{value:"PREMIUM",label:"Premium"},{value:"STANDARD",label:"Standard"},{value:"ECONOMY",label:"Economy"}],value:c.quality_grade,onChange:a=>y(s=>({...s,quality_grade:a.target.value}))}),e.jsx(g,{label:"Location",value:c.location,onChange:a=>y(s=>({...s,location:a.target.value})),placeholder:"e.g., Nairobi, Kenya"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(g,{label:"Product Image",type:"file",accept:"image/*",onChange:Ze}),c.image&&e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:URL.createObjectURL(c.image),alt:"Preview",style:{maxWidth:"100px",maxHeight:"100px"}})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(u,{type:"submit",variant:"primary",loading:Oe,disabled:!((Te=c.title)!=null&&Te.trim())||!c.price||!c.quantity||!c.category,children:"List Product"}),e.jsx(u,{type:"button",variant:"outline",onClick:()=>I(!1),children:"Cancel"})]})]})}),e.jsx(F,{isOpen:ze,onClose:()=>A(!1),title:"Create New Task",size:"medium",children:e.jsxs("form",{onSubmit:Ke,className:"create-task-form",children:[e.jsx(g,{label:"Task Title *",value:f.title,onChange:a=>w(s=>({...s,title:a.target.value})),required:!0}),e.jsx(ne,{label:"Description",value:f.description,onChange:a=>w(s=>({...s,description:a.target.value})),rows:3,placeholder:"Describe the task details..."}),e.jsxs("div",{className:"form-row",children:[e.jsx(C,{label:"Task Type",options:[{value:"PLANTING",label:"Planting"},{value:"HARVESTING",label:"Harvesting"},{value:"IRRIGATION",label:"Irrigation"},{value:"FERTILIZATION",label:"Fertilization"},{value:"PEST_CONTROL",label:"Pest Control"},{value:"OTHER",label:"Other"}],value:f.task_type,onChange:a=>w(s=>({...s,task_type:a.target.value}))}),e.jsx(C,{label:"Priority",options:[{value:"LOW",label:"Low"},{value:"MEDIUM",label:"Medium"},{value:"HIGH",label:"High"},{value:"URGENT",label:"Urgent"}],value:f.priority,onChange:a=>w(s=>({...s,priority:a.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(g,{label:"Due Date",type:"datetime-local",value:f.due_date,onChange:a=>w(s=>({...s,due_date:a.target.value}))}),e.jsx(g,{label:"Estimated Hours",type:"number",min:"1",max:"1000",value:f.estimated_hours,onChange:a=>w(s=>({...s,estimated_hours:parseInt(a.target.value)||1}))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(u,{type:"submit",variant:"primary",disabled:!f.title,children:"Create Task"}),e.jsx(u,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"})]})]})}),e.jsx(F,{isOpen:$e,onClose:ea,title:"AI Price Prediction",size:"large",children:e.jsxs("div",{className:"price-prediction-modal",children:[xe&&e.jsx(le,{type:"warning",onClose:()=>E(""),children:xe}),e.jsxs("form",{onSubmit:Xe,className:"prediction-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsx(C,{label:"Crop Type *",options:[{value:"",label:"Select Crop Type"},{value:"Maize",label:"Maize"},{value:"Rice",label:"Rice"},{value:"Beans",label:"Beans"},{value:"Cassava",label:"Cassava"},{value:"Wheat",label:"Wheat"},{value:"Tomatoes",label:"Tomatoes"},{value:"Potatoes",label:"Potatoes"}],value:T.cropType,onChange:a=>R(s=>({...s,cropType:a.target.value})),required:!0}),e.jsx(g,{label:"Region/Market *",value:T.market,onChange:a=>R(s=>({...s,market:a.target.value})),required:!0})]}),e.jsx(C,{label:"Prediction Period",options:[{value:"1 Week",label:"1 Week"},{value:"1 Month",label:"1 Month"},{value:"3 Months",label:"3 Months"},{value:"6 Months",label:"6 Months"},{value:"1 Year",label:"1 Year"}],value:T.predictionPeriod,onChange:a=>R(s=>({...s,predictionPeriod:a.target.value}))}),e.jsx("div",{className:"form-actions",children:e.jsx(u,{type:"submit",variant:"primary",loading:Ye,disabled:!T.cropType||!T.market,children:"Get Prediction"})})]}),m&&e.jsxs("div",{className:"prediction-results",children:[e.jsx("h4",{children:"Price Prediction Results"}),e.jsxs("div",{className:"prediction-card",children:[e.jsxs("div",{className:"prediction-header",children:[e.jsx("h3",{children:m.crop}),e.jsx("span",{className:"prediction-region",children:m.region})]}),e.jsxs("div",{className:"prediction-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Current Price"}),e.jsxs("span",{className:"price",children:["$",m.current_price]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Predicted Price"}),e.jsxs("span",{className:"price predicted",children:["$",m.predicted_price]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Confidence"}),e.jsxs("span",{className:"confidence",children:[((m.confidence||0)*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("label",{children:"Trend"}),e.jsx("span",{className:`trend trend-${m.trend}`,children:m.trend})]})]}),m.price_range&&e.jsxs("div",{className:"price-range",children:[e.jsx("h5",{children:"Price Range"}),e.jsxs("div",{className:"range-bars",children:[e.jsxs("div",{className:"range-min",children:["$",m.price_range.min]}),e.jsxs("div",{className:"range-avg",children:["$",m.price_range.avg]}),e.jsxs("div",{className:"range-max",children:["$",m.price_range.max]})]})]}),m.predictions&&m.predictions.length>0&&e.jsxs("div",{className:"future-predictions",children:[e.jsx("h5",{children:"Future Predictions"}),e.jsx("div",{className:"predictions-list",children:m.predictions.slice(0,5).map((a,s)=>e.jsxs("div",{className:"future-prediction",children:[e.jsx("span",{children:a.date}),e.jsxs("span",{children:["$",a.predicted_price]})]},s))})]})]})]})]})}),e.jsx(F,{isOpen:He,onClose:()=>O(!1),title:"Product Details",size:"large",children:r&&e.jsxs("div",{className:"product-details",children:[e.jsxs("div",{className:"product-details__header",children:[e.jsx("div",{className:"product-image",children:r.image?e.jsx("img",{src:r.image,alt:r.title}):e.jsx("div",{className:"product-image-placeholder large",children:"ðŸŒ±"})}),e.jsxs("div",{className:"product-info",children:[e.jsx("h2",{children:r.title}),e.jsxs("div",{className:"product-meta",children:[e.jsxs("span",{className:"product-price",children:["$",r.price]}),e.jsxs("span",{className:"product-quantity",children:[r.quantity," ",r.unit]}),e.jsx("span",{className:`quality-badge quality-${(qe=r.quality_grade)==null?void 0:qe.toLowerCase()}`,children:r.quality_grade})]}),e.jsxs("div",{className:"product-seller",children:[e.jsx("strong",{children:"Seller:"})," ",r.farmer_email||"Unknown seller"]}),e.jsxs("div",{className:"product-location",children:[e.jsx("strong",{children:"Location:"})," ",r.location||"Not specified"]}),e.jsxs("div",{className:"product-category",children:[e.jsx("strong",{children:"Category:"})," ",ie(r)]})]})]}),e.jsxs("div",{className:"product-details__content",children:[e.jsx("h4",{children:"Description"}),e.jsx("p",{children:r.description||"No description available."}),r.market_insights&&e.jsxs("div",{className:"market-insights",children:[e.jsx("h4",{children:"Market Insights"}),((Ae=r.demand_level)==null?void 0:Ae.level)&&e.jsxs("div",{className:"insight-item",children:[e.jsx("strong",{children:"Demand:"}),e.jsx("span",{className:`demand-badge demand-${(Le=(Ee=r.demand_level)==null?void 0:Ee.level)==null?void 0:Le.toLowerCase()}`,children:(Me=r.demand_level)==null?void 0:Me.level})]})]}),e.jsxs("div",{className:"product-actions",children:[!M(r)&&e.jsx(u,{variant:"primary",onClick:()=>{O(!1),re(r)},children:"Contact Seller"}),e.jsx(u,{variant:"outline",onClick:()=>O(!1),children:"Close"})]})]})]})}),e.jsx(F,{isOpen:Be,onClose:()=>L(!1),title:`Contact Seller - ${r==null?void 0:r.title}`,size:"medium",children:r&&e.jsxs("div",{className:"contact-seller",children:[e.jsxs("div",{className:"seller-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Product:"})," ",r.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," $",r.price," per ",r.unit]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Seller:"})," ",r.farmer_email||"Unknown seller"]})]}),e.jsxs("form",{onSubmit:aa,className:"contact-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsx(g,{label:"Quantity",type:"number",min:"1",max:r.quantity,value:_.quantity,onChange:a=>U(s=>({...s,quantity:parseInt(a.target.value)||1}))}),e.jsxs("div",{className:"total-price",children:[e.jsx("strong",{children:"Total: "}),"$",(r.price*_.quantity).toFixed(2)]})]}),e.jsx(ne,{label:"Message to Seller",value:_.message,onChange:a=>U(s=>({...s,message:a.target.value})),rows:4,placeholder:"Type your message to the seller...",required:!0}),e.jsxs("div",{className:"contact-actions",children:[e.jsx(u,{type:"submit",variant:"primary",children:"Send Message"}),e.jsx(u,{type:"button",variant:"outline",onClick:sa,children:"Create Order"}),e.jsx(u,{type:"button",variant:"text",onClick:()=>L(!1),children:"Cancel"})]})]})]})})]})};export{ya as default};
//# sourceMappingURL=Marketplace-C9jKoMRU.js.map
