import{g as V,a as J,r as l,f as p,j as e,b as K,B as r,C as n}from"./index-C07V4r8E.js";import{I as t}from"./input-kLXWFfVH.js";import{M as T}from"./Modal-EQcgVxp4.js";import{S as F}from"./Select-CJWIEbcx.js";import{T as X}from"./Tabs-xtqnmJ3V.js";import{T as Z}from"./TextArea-Dt6jrW99.js";const le=()=>{var D,A;const{id:o}=V(),E=J(),[c,M]=l.useState(null),[j,R]=l.useState([]),[g,I]=l.useState([]),[i,L]=l.useState(null),[$,q]=l.useState(!0),[y,G]=l.useState("overview"),[H,N]=l.useState(!1),[O,f]=l.useState(!1),[z,C]=l.useState(!1),[k,w]=l.useState(null),[v,_]=l.useState({plot_number:"",area:"",current_crop:"",soil_ph:"",soil_moisture:"",farm:o}),[u,x]=l.useState({title:"",description:"",task_type:"",due_date:"",estimated_duration:"",priority:"MEDIUM",plot:""}),[d,m]=l.useState({crop_name:"",variety:"",planting_date:"",expected_harvest_date:"",yield_amount:"",market_price:"",fertilizer_used:{},water_usage:"",total_cost:""});l.useEffect(()=>{o&&b()},[o]);const b=async()=>{try{const[s,a,h,P]=await Promise.all([p.getFarm(o),p.getPlots(o),p.getFarmTasks(o),p.getFarmAnalytics(o)]);M(s.data),R(a.data.results||a.data||[]),I(h.data.tasks||[]),L(P.data.analytics)}catch(s){console.error("Error fetching farm data:",s)}finally{q(!1)}},U=async s=>{s.preventDefault();try{await p.createPlot(v),N(!1),_({plot_number:"",area:"",current_crop:"",soil_ph:"",soil_moisture:"",farm:o}),b()}catch(a){console.error("Error creating plot:",a)}},Y=async s=>{s.preventDefault();try{await p.createTask(u),f(!1),x({title:"",description:"",task_type:"",due_date:"",estimated_duration:"",priority:"MEDIUM",plot:""}),b()}catch(a){console.error("Error creating task:",a)}},B=async s=>{s.preventDefault();try{await p.addCropToPlot(k.id,d),C(!1),m({crop_name:"",variety:"",planting_date:"",expected_harvest_date:"",yield_amount:"",market_price:"",fertilizer_used:{},water_usage:"",total_cost:""}),w(null),b()}catch(a){console.error("Error adding crop:",a)}},S=async s=>{try{await p.completeTask(s),b()}catch(a){console.error("Error completing task:",a)}},W=async()=>{try{const s=await p.generateRecommendations(o);alert("Recommendations generated successfully!"),console.log("Recommendations:",s.data)}catch(s){console.error("Error generating recommendations:",s)}};return $?e.jsxs("div",{className:"loading",children:[e.jsx(K,{size:"large"}),e.jsx("p",{children:"Loading farm details..."})]}):c?e.jsxs("div",{className:"farm-detail",children:[e.jsxs("div",{className:"farm-detail__header",children:[e.jsxs("div",{className:"farm-detail__info",children:[e.jsx("h1",{children:c.name}),e.jsxs("p",{children:[c.location," â€¢ ",c.total_area," acres â€¢ ",c.soil_type_display||c.soil_type]}),e.jsxs("div",{className:"farm-stats",children:[e.jsxs("span",{children:[j.length," Plots"]}),e.jsxs("span",{children:[g.filter(s=>s.status==="PENDING").length," Pending Tasks"]}),e.jsxs("span",{className:`productivity-badge productivity-${((D=c.productivity_level)==null?void 0:D.toLowerCase())||"medium"}`,children:[c.productivity_level||"Medium"," Productivity"]})]})]}),e.jsxs("div",{className:"farm-detail__actions",children:[e.jsx(r,{variant:"outline",onClick:()=>N(!0),children:"Add Plot"}),e.jsx(r,{variant:"outline",onClick:()=>f(!0),children:"Add Task"}),e.jsx(r,{variant:"primary",onClick:W,children:"Get AI Recommendations"})]})]}),e.jsx(X,{tabs:[{id:"overview",label:"Overview"},{id:"plots",label:"Plots"},{id:"tasks",label:"Tasks"},{id:"analytics",label:"Analytics"}],activeTab:y,onChange:G}),y==="overview"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"overview-grid",children:[e.jsx(n,{title:"Farm Description",children:e.jsx("p",{children:c.description||"No description provided."})}),e.jsx(n,{title:"Quick Stats",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("h3",{children:j.length}),e.jsx("p",{children:"Total Plots"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("h3",{children:j.filter(s=>s.current_crop).length}),e.jsx("p",{children:"Active Crops"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("h3",{children:g.filter(s=>s.status==="PENDING").length}),e.jsx("p",{children:"Pending Tasks"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("h3",{children:i!=null&&i.success_rate?`${(i.success_rate*100).toFixed(1)}%`:"N/A"}),e.jsx("p",{children:"Success Rate"})]})]})})]}),e.jsx(n,{title:"Recent Activity",children:e.jsx("div",{className:"activity-list",children:g.slice(0,5).map(s=>e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"ðŸ“"}),e.jsxs("div",{className:"activity-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:s.title})," - Due ",new Date(s.due_date).toLocaleDateString()]}),e.jsxs("small",{children:[s.priority_display," Priority"]})]}),e.jsx(r,{size:"small",variant:"outline",onClick:()=>S(s.id),children:"Complete"})]},s.id))})})]}),y==="plots"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"plots-grid",children:j.map(s=>e.jsxs(n,{className:"plot-card",children:[e.jsxs("div",{className:"plot-card__header",children:[e.jsxs("h3",{children:["Plot ",s.plot_number]}),e.jsx("div",{className:"plot-actions",children:e.jsx(r,{size:"small",variant:"outline",onClick:()=>{w(s),C(!0)},children:"Add Crop"})})]}),e.jsxs("div",{className:"plot-card__info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Area:"})," ",s.area," acres"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Current Crop:"})," ",s.current_crop||"None"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Soil pH:"})," ",s.soil_ph||"Not set"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.crop_status_display||s.crop_status]}),s.days_to_harvest&&e.jsxs("p",{children:[e.jsx("strong",{children:"Days to Harvest:"})," ",s.days_to_harvest]})]}),s.ai_recommendations&&s.ai_recommendations.length>0&&e.jsxs("div",{className:"plot-recommendations",children:[e.jsx("h4",{children:"AI Recommendations"}),s.ai_recommendations.slice(0,2).map((a,h)=>e.jsxs("div",{className:"recommendation-item",children:[e.jsx("span",{className:`priority-badge priority-${a.priority}`,children:a.priority}),e.jsx("p",{children:a.message})]},h))]})]},s.id))}),j.length===0&&e.jsx(n,{className:"no-plots",children:e.jsxs("div",{className:"no-plots-content",children:[e.jsx("h3",{children:"No Plots Yet"}),e.jsx("p",{children:"Add your first plot to start managing crops."}),e.jsx(r,{variant:"primary",onClick:()=>N(!0),children:"Add First Plot"})]})})]}),y==="tasks"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tasks-list",children:g.map(s=>{var a,h;return e.jsx(n,{className:"task-card",children:e.jsxs("div",{className:"task-card__content",children:[e.jsxs("div",{className:"task-info",children:[e.jsx("h4",{children:s.title}),e.jsx("p",{children:s.description}),e.jsxs("div",{className:"task-meta",children:[e.jsxs("span",{children:["Due: ",new Date(s.due_date).toLocaleDateString()]}),e.jsxs("span",{children:["Type: ",s.task_type]}),e.jsx("span",{className:`priority-badge priority-${(a=s.priority)==null?void 0:a.toLowerCase()}`,children:s.priority_display||s.priority}),e.jsx("span",{className:`status-badge status-${(h=s.status)==null?void 0:h.toLowerCase()}`,children:s.status_display||s.status})]})]}),e.jsx("div",{className:"task-actions",children:s.status==="PENDING"&&e.jsx(r,{variant:"primary",size:"small",onClick:()=>S(s.id),children:"Complete"})})]})},s.id)})}),g.length===0&&e.jsx(n,{className:"no-tasks",children:e.jsxs("div",{className:"no-tasks-content",children:[e.jsx("h3",{children:"No Tasks Yet"}),e.jsx("p",{children:"Create your first task to manage farm operations."}),e.jsx(r,{variant:"primary",onClick:()=>f(!0),children:"Add First Task"})]})})]}),y==="analytics"&&e.jsx("div",{className:"tab-content",children:i?e.jsxs("div",{className:"analytics-grid",children:[e.jsxs(n,{title:"Productivity Metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsxs("h3",{children:[(i.success_rate*100).toFixed(1),"%"]}),e.jsx("p",{children:"Success Rate"})]}),e.jsxs("div",{className:"metric",children:[e.jsx("h3",{children:((A=i.average_yield)==null?void 0:A.toFixed(2))||"N/A"}),e.jsx("p",{children:"Average Yield"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("h3",{children:[(i.efficiency_score*100).toFixed(1),"%"]}),e.jsx("p",{children:"Efficiency Score"})]})]}),e.jsxs(n,{title:"Financial Overview",children:[e.jsxs("div",{className:"metric",children:[e.jsxs("h3",{children:["$",i.total_revenue||0]}),e.jsx("p",{children:"Total Revenue"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("h3",{children:["$",i.total_costs||0]}),e.jsx("p",{children:"Total Costs"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("h3",{children:["$",i.net_profit||0]}),e.jsx("p",{children:"Net Profit"})]})]}),i.improvement_recommendations&&i.improvement_recommendations.length>0&&e.jsx(n,{title:"Improvement Recommendations",children:e.jsx("div",{className:"recommendations-list",children:i.improvement_recommendations.map((s,a)=>{var h;return e.jsxs("div",{className:"recommendation-item",children:[e.jsx("h4",{children:s.title}),e.jsx("p",{children:s.description}),e.jsx("div",{className:"recommendation-actions",children:(h=s.actions)==null?void 0:h.map((P,Q)=>e.jsx("span",{className:"action-tag",children:P},Q))})]},a)})})})]}):e.jsx(n,{children:e.jsxs("div",{className:"no-analytics",children:[e.jsx("h3",{children:"No Analytics Data"}),e.jsx("p",{children:"Analytics data will be available after you start adding crops and tasks."})]})})}),e.jsx(T,{isOpen:H,onClose:()=>N(!1),title:"Add New Plot",children:e.jsxs("form",{onSubmit:U,className:"plot-form",children:[e.jsx(t,{label:"Plot Number",value:v.plot_number,onChange:s=>_(a=>({...a,plot_number:s.target.value})),required:!0}),e.jsx(t,{label:"Area (acres)",type:"number",step:"0.01",value:v.area,onChange:s=>_(a=>({...a,area:s.target.value})),required:!0}),e.jsx(t,{label:"Current Crop",value:v.current_crop,onChange:s=>_(a=>({...a,current_crop:s.target.value}))}),e.jsxs("div",{className:"form-row",children:[e.jsx(t,{label:"Soil pH",type:"number",step:"0.1",min:"0",max:"14",value:v.soil_ph,onChange:s=>_(a=>({...a,soil_ph:s.target.value}))}),e.jsx(t,{label:"Soil Moisture %",type:"number",step:"0.1",min:"0",max:"100",value:v.soil_moisture,onChange:s=>_(a=>({...a,soil_moisture:s.target.value}))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(r,{type:"submit",variant:"primary",children:"Add Plot"})]})]})}),e.jsx(T,{isOpen:O,onClose:()=>f(!1),title:"Add New Task",children:e.jsxs("form",{onSubmit:Y,className:"task-form",children:[e.jsx(t,{label:"Task Title",value:u.title,onChange:s=>x(a=>({...a,title:s.target.value})),required:!0}),e.jsx(Z,{label:"Description",value:u.description,onChange:s=>x(a=>({...a,description:s.target.value})),rows:3}),e.jsx(t,{label:"Task Type",value:u.task_type,onChange:s=>x(a=>({...a,task_type:s.target.value})),required:!0}),e.jsx(t,{label:"Due Date",type:"date",value:u.due_date,onChange:s=>x(a=>({...a,due_date:s.target.value})),required:!0}),e.jsx(t,{label:"Estimated Duration (hours)",type:"number",value:u.estimated_duration,onChange:s=>x(a=>({...a,estimated_duration:s.target.value}))}),e.jsx(F,{label:"Priority",options:[{value:"LOW",label:"Low"},{value:"MEDIUM",label:"Medium"},{value:"HIGH",label:"High"},{value:"URGENT",label:"Urgent"}],value:u.priority,onChange:s=>x(a=>({...a,priority:s.target.value}))}),e.jsx(F,{label:"Plot (Optional)",options:j.map(s=>({value:s.id,label:`Plot ${s.plot_number}`})),value:u.plot,onChange:s=>x(a=>({...a,plot:s.target.value}))}),e.jsxs("div",{className:"form-actions",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(r,{type:"submit",variant:"primary",children:"Add Task"})]})]})}),e.jsx(T,{isOpen:z,onClose:()=>{C(!1),w(null)},title:`Add Crop to Plot ${k==null?void 0:k.plot_number}`,children:e.jsxs("form",{onSubmit:B,className:"crop-form",children:[e.jsx(t,{label:"Crop Name",value:d.crop_name,onChange:s=>m(a=>({...a,crop_name:s.target.value})),required:!0}),e.jsx(t,{label:"Variety",value:d.variety,onChange:s=>m(a=>({...a,variety:s.target.value}))}),e.jsxs("div",{className:"form-row",children:[e.jsx(t,{label:"Planting Date",type:"date",value:d.planting_date,onChange:s=>m(a=>({...a,planting_date:s.target.value})),required:!0}),e.jsx(t,{label:"Expected Harvest Date",type:"date",value:d.expected_harvest_date,onChange:s=>m(a=>({...a,expected_harvest_date:s.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(t,{label:"Expected Yield",type:"number",step:"0.01",value:d.yield_amount,onChange:s=>m(a=>({...a,yield_amount:s.target.value}))}),e.jsx(t,{label:"Market Price",type:"number",step:"0.01",value:d.market_price,onChange:s=>m(a=>({...a,market_price:s.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(t,{label:"Water Usage (liters)",type:"number",step:"0.01",value:d.water_usage,onChange:s=>m(a=>({...a,water_usage:s.target.value}))}),e.jsx(t,{label:"Total Cost",type:"number",step:"0.01",value:d.total_cost,onChange:s=>m(a=>({...a,total_cost:s.target.value}))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>{C(!1),w(null)},children:"Cancel"}),e.jsx(r,{type:"submit",variant:"primary",children:"Add Crop"})]})]})})]}):e.jsxs("div",{className:"error-page",children:[e.jsx("h2",{children:"Farm not found"}),e.jsx(r,{onClick:()=>E("/farms"),children:"Back to Farms"})]})};export{le as default};
//# sourceMappingURL=FarmDetail-DjKG17nC.js.map
